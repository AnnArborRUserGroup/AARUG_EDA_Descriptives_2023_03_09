---
title: "Tables in R for AARUG Presentation"
author: "Barry DeCicco"
date: "For Ann Arbor R Users' Group, Mar 9, 2023"
output:  
  html_document:
    toc:  true
    toc_float: true
    code_folding: show



  
---
```{r}

  # ioslides_presentation:
  #   template: quarterly-report.html

```

```{r setup,  collapse=TRUE}  

# load libraries as needed:
# 

library(pastecs)
# https://stats.idre.ucla.edu/r/faq/how-can-i-get-a-table-of-basic-descriptive-statistics-for-my-variables/

# For the gapminder data sets:
# install.packages("gapminder")

library(htmlTable)
library(psych)
library(tidyverse)
library(inspectdf)
library(janitor)

library(Hmisc)
library(summarytools)
library(readr)

# library(devtools)
# devtools::install_github("alastairrushworth/inspectdf")

library(inspectdf)   
# https://www.r-bloggers.com/part-2-simple-eda-in-r-with-inspectdf/
 
library(kableExtra)
library(magrittr)

library(gapminder)

```

## Import the Gapminder data set:


```{r import data, include=TRUE}


View(gapminder)

```

# Using Base R Commands to Inspect the Data Frame

This increases your knowledge of the data set, and catches import errors.

```{r eda, collapse=TRUE}
dim(gapminder)
class(gapminder)
lapply(gapminder, class)
sapply(gapminder, function(x) sum(is.na(x)))   
sapply(gapminder, function(x) sum(is.na(x)/length(x)))  
# https://sebastiansauer.github.io/sum-isna/
str(gapminder)
summary(gapminder)
head(gapminder)
tail(gapminder)

```


## The 'lapply' command can carry out a function across a list. A dataframe is a list of columns:

```{r}

lapply(gapminder, class)

```
### Sometimes you want to clean this up - use the <strong>kable</strong> command:


```{r lapply-class-kable}

gapminder %>%
  lapply(., class) %>%
  as.data.frame() %>%
  pivot_longer(cols=everything(),
               names_to='Variable',
               values_to='Type') %>%
  dplyr::arrange(Type, Variable ) %>%
  kable(caption = "<strong><center>Variable Classes</center></strong>", full_width = F) %>%
  # pack_rows(index = c("String Variable" = 4, "Date" = 1,
  #                     "Numeric" = 4)) %>%
  column_spec(1, width = "5cm", bold = T) %>%
  column_spec(2, width = "5cm") 


```



## Summary table using <strong>pastecs</strong> package:

```{r pastecs, collapse=TRUE}



# Set formatting options: 

options(scipen=100)
options(digits=2)

gapminder %>% 
  select_if(is.numeric) %>% 
  stat.desc()





```



## Summary table with fewer statistics:

```{r pastecs, collapse=TRUE}



# Set formatting options: 

options(scipen=100)
options(digits=2)

# Run a more limited set of statistics:

gapminder %>% 
  select_if(is.numeric) %>% 
  stat.desc(., basic=F)




```


## Getting a better table with the <strong>kable</strong> package:

First, convert the row names to a column.


```{r pastecs, collapse=TRUE}



# Set formatting options: 

options(scipen=100)
options(digits=2)

gapminder %>% 
  select_if(is.numeric) %>% 
  stat.desc() %>% 
  tibble::rownames_to_column(var="Statistic") %>% 
  kable(caption = "<strong><center>Descriptive Statistics</center></strong>", full_width = F,
        escape = FALSE,
   col.names= c("Statistic <br/> Name",
                "Year",
                "Life Expectancy",
                "Population",
                "GDP per<br/>Capita" )
) %>% 
    kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>% 
  column_spec(1, width = "5cm", bold = T) %>%
  column_spec(2:5, width = "3cm") 



```


# The <strong>describe<strong> packages

There are two describe commands, one in the Hmisc pacakge, and one in the psych
package.  We will use the <strong>Hmisc</strong> version


## Hmisc Describe


Running the command with no formatting.  It's ugly.


```{r Hmisc-describe, collapse=TRUE}


gapminder %>%
#  dplyr::select_if( is.numeric) %>%
  Hmisc::describe() %>%
  as.data.frame() %>%
  dplyr::select(n) %>%
  dplyr::mutate( n_missing = nrow(gapminder ) -n,
                 Percent_missing =round(100*(n_missing/nrow(gapminder )),1)
                ) %>%
  dplyr::select(n, n_missing,Percent_missing ) %>%
  tibble::rownames_to_column("Variable") %>%
  kable(caption = "<strong>Miassing Values for Numeric Variables</strong>",
        escape = FALSE,
        col.names= c("Variable <br/> Name",
                     "Count <br/>(non-missing)",
                     "Count <br/>Missing",
                     "Percent <br/>Missing" )
  ) %>%
  column_spec(1, width = "5cm", bold = T)%>%
  column_spec(2:4, width = "3cm") 





```


Running the command, and then modifying the output:

```{r describe-then-kable, collapse=TRUE}

gapminder %>%
  dplyr::select_if( is.numeric) %>%
  psych::describe() %>%
  as.data.frame() %>%
  dplyr::select(n) %>%
  dplyr::mutate( n_missing = nrow(gapminder ) -n,
                 Percent_missing =round(100*(n_missing/nrow(gapminder )),1)
                ) %>%
  dplyr::select(n, n_missing,Percent_missing ) %>%
  tibble::rownames_to_column("Variable") %>%
  kable(caption = "<strong>Miassing Values for Numeric Variables</strong>",
        escape = FALSE,
        col.names= c("Variable <br/> Name",
                     "Count <br/>(non-missing)",
                     "Count <br/>Missing",
                     "Percent <br/>Missing" )
  ) %>%
  column_spec(1, width = "5cm", bold = T)%>%
  column_spec(2:4, width = "3cm") 





```

## Describe by Group:

```{r describeBy}




gapminder %>%
  group_by(year) %>% 
#  dplyr::select_if( is.numeric) %>%
  psych::describe()
  as.data.frame() %>%
  dplyr::select(n) %>%
  dplyr::mutate( n_missing = nrow(gapminder ) -n,
                 Percent_missing =round(100*(n_missing/nrow(gapminder )),1)
                ) %>%
  dplyr::select(n, n_missing,Percent_missing ) %>%
  tibble::rownames_to_column("Variable") %>%
  kable(caption = "<strong>Miassing Values for Numeric Variables</strong>",
        escape = FALSE,
        col.names= c("Variable <br/> Name",
                     "Count <br/>(non-missing)",
                     "Count <br/>Missing",
                     "Percent <br/>Missing" )
  ) %>%
  column_spec(1, width = "5cm", bold = T)%>%
  column_spec(2:4, width = "3cm") 


```















